<div class="card">
    <p-toast></p-toast>
    <p-toolbar class="mb-4 gap-2">
        <div class="flex justify-content-start align-items-center w-full">
            <p-dropdown 
            [options]="groupedCourses"  
            [(ngModel)]="selectedCourse" 
            placeholder="Selecciona un curso..." 
            (onChange)="filterSubjects()" 
            [group]="true">
            <ng-template let-group pTemplate="group">
                <div class="flex align-items-center">
                    <span>{{ group.course }}</span>
                </div>
            </ng-template>
        
            <ng-template let-option pTemplate="item">
                <div class="ml-4">
                    <span>{{ option.section }}</span>
                </div>
            </ng-template>
        
            <ng-template pTemplate="selectedItem" let-selected>
                <span>{{ selected.year }} - {{ selected.section }}</span>
            </ng-template>
        </p-dropdown>
            <p-button 
                pRipple 
                severity="success" 
                label="Agregar asignaturas" 
                icon="pi pi-plus" 
                class="ml-2 mr-2" />
                <p-button 
                pRipple 
                severity="danger" 
                label="Retirar" 
                icon="pi pi-trash" 
                (click)="deleteSelectedSubjects()" 
                [disabled]="!selectedSubjects || !selectedSubjects.length" />
        </div>
    </p-toolbar>

    <p-table
    #dt
    [value]="subjects"
    [rows]="10"
    [paginator]="selectedCourse"
    [globalFilterFields]="['name', 'country.name', 'representative.name', 'status']"
    [tableStyle]="{ 'min-width': '75rem' }"
    [(selection)]="selectedSubjects"
    [rowHover]="true"
    dataKey="id"
    currentPageReportTemplate="Mostrando {first} de {last} de {totalRecords} entradas"
    [showCurrentPageReport]="true">
    <ng-template pTemplate="caption">
        <div class="flex align-items-center justify-content-between">
            <h5 class="m-0">Gesti√≥n de Asignaturas</h5>
            <span class="p-input-icon-left">
                <i class="pi pi-search"></i>
                <input 
                    pInputText 
                    type="text" 
                    (input)="dt.filterGlobal($event.target.value, 'contains')" 
                    placeholder="Buscar..." />
            </span>
        </div>
    </ng-template>
    <ng-template pTemplate="header">
        <tr>
            <th style="width: 4rem">
                <p-tableHeaderCheckbox *ngIf="selectedCourse; else skeleton"/>
                <ng-template #skeleton>
                    <p-skeleton />
                </ng-template>
            </th>
            <th pSortableColumn="name" style="min-width:15rem">
                Asignatura <p-sortIcon field="name" />
            </th>
            <th pSortableColumn="category" style="min-width:10rem">
                Horas semanales <p-sortIcon field="hours_per_week" />
            </th>
            <th pSortableColumn="status" style="min-width:10rem">
                Horas totales del ciclo escolar <p-sortIcon field="hours_per_year" />
            </th>
            <th></th>
        </tr>
    </ng-template>
    <ng-template pTemplate="body" let-subject>
        <tr>
            <td>
                <p-tableCheckbox [value]="subject" *ngIf="selectedCourse; else skeleton"/>
                <ng-template #skeleton>
                    <p-skeleton />
                </ng-template>
            </td>
            <td>
                <div *ngIf="selectedCourse; else skeleton">
                    {{ subject.name }}
                </div>
                <ng-template #skeleton>
                    <p-skeleton />
                </ng-template>
            </td>
            <td style="text-align: center; padding-right: 100px;">
                <div *ngIf="selectedCourse; else skeleton">
                    {{ subject.hours_per_week }}
                </div>
                <ng-template #skeleton>
                    <p-skeleton />
                </ng-template>
            </td>
            <td style="text-align: center; padding-right: 100px;">
                <div *ngIf="selectedCourse; else skeleton">
                    {{ subject.hours_per_year }}
                </div>
                <ng-template #skeleton>
                    <p-skeleton />
                </ng-template>
            </td>
            
            <td>
                <p-button *ngIf="selectedCourse; else skelebutton"
                    pRipple 
                    icon="pi pi-trash" 
                    severity="danger" 
                    [rounded]="true" 
                    [outlined]="true" 
                    (click)="deleteSubject(subject)" />
                    <ng-template #skelebutton>
                        <p-skeleton size="3rem" styleClass="mr-3"/>
                    </ng-template>

            </td>
        </tr>
    </ng-template>
</p-table>

    <p-confirmDialog [style]="{ width: '450px' }"></p-confirmDialog>
</div>
